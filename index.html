<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Calibration Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #4a4a4a;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .quarter-selector {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .quarter-info {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .quarter-badge {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .quarter-select {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
        }

        .quarter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .quarterly-progress {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .progress-header {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .quarterly-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .quarter-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .quarter-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }

        .rating-trend {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .trend-arrow {
            font-weight: bold;
            font-size: 1.2em;
        }

        .trend-up { color: #28a745; }
        .trend-down { color: #dc3545; }
        .trend-same { color: #6c757d; }

        .focus-recommendations {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .recommendation-item {
            background: white;
            border-left: 4px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .priority-high { border-left-color: #f44336; }
        .priority-medium { border-left-color: #ff9800; }
        .priority-low { border-left-color: #4caf50; }

        .main-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:hover, .nav-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .content-section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            font-size: 2em;
            margin-bottom: 20px;
            color: #4a4a4a;
            font-weight: 300;
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .employee-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            border-color: #667eea;
        }

        .employee-name {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .employee-role {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .performance-overview {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .performance-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .badge-below { background: #ffe6e6; color: #d63384; }
        .badge-growth { background: #fff3cd; color: #f57c00; }
        .badge-meets { background: #d1ecf1; color: #0c5460; }
        .badge-exceeds { background: #d4edda; color: #155724; }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .performance-dimensions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .dimension-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .dimension-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .dimension-description {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .rating-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .rating-btn {
            flex: 1;
            min-width: 70px;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .rating-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .notes-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .note-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .note-date {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .note-content {
            line-height: 1.6;
        }

        .insights-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .insight-item {
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .insight-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .development-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .development-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #333;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab:hover, .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .performance-dimensions {
                grid-template-columns: 1fr;
            }
            
            .development-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Employee Calibration Manager</h1>
            <p>Streamline your 1:1 notes, performance tracking, and employee development</p>
        </header>

        <div class="quarter-selector">
            <div class="quarter-info">
                <div class="quarter-badge" id="current-quarter">Q3 FY2025</div>
                <div>
                    <label for="quarter-select">View Quarter:</label>
                    <select id="quarter-select" class="quarter-select" onchange="changeQuarter()"></select>
                </div>
            </div>
            <div style="font-size: 0.9em; color: #666;">
                Fiscal Year: February - January
            </div>
        </div>

        <nav class="main-nav">
            <button class="nav-btn active" onclick="showSection('employees')">Employees</button>
            <button class="nav-btn" onclick="showSection('add-employee')">Add Employee</button>
            <button class="nav-btn" onclick="showSection('analytics')">Analytics</button>
            <button class="nav-btn" onclick="showSection('export')">Export Data</button>
        </nav>

        <!-- Employees Section -->
        <section id="employees" class="content-section active">
            <h2 class="section-title">Team Overview</h2>
            <div id="employee-list" class="employee-grid">
                <!-- Employee cards will be dynamically generated -->
            </div>
        </section>

        <!-- Add Employee Section -->
        <section id="add-employee" class="content-section">
            <h2 class="section-title">Add New Employee</h2>
            <form id="add-employee-form">
                <div class="form-group">
                    <label for="employee-name">Employee Name:</label>
                    <input type="text" id="employee-name" required>
                </div>
                <div class="form-group">
                    <label for="employee-role">Role:</label>
                    <input type="text" id="employee-role" required>
                </div>
                <div class="form-group">
                    <label for="employee-start-date">Start Date:</label>
                    <input type="date" id="employee-start-date" required>
                </div>
                <div class="form-group">
                    <label for="employee-baseline">Current Baseline/Status:</label>
                    <textarea id="employee-baseline" placeholder="Describe where this employee currently stands in their role..."></textarea>
                </div>
                <button type="submit" class="btn">Add Employee</button>
            </form>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="content-section">
            <h2 class="section-title">Team Analytics</h2>
            <div id="analytics-content">
                <!-- Analytics will be dynamically generated -->
            </div>
        </section>

        <!-- Export Section -->
        <section id="export" class="content-section">
            <h2 class="section-title">Export Data</h2>
            <p>Export employee data and performance reviews for reporting and analysis.</p>
            <div style="margin-top: 20px;">
                <button class="btn" onclick="exportData('json')">Export as JSON</button>
                <button class="btn" onclick="exportData('csv')">Export as CSV</button>
                <button class="btn btn-secondary" onclick="importData()">Import Data</button>
            </div>
            <input type="file" id="import-file" style="display: none;" accept=".json" onchange="handleImport(event)">
        </section>
    </div>

    <!-- Employee Detail Modal -->
    <div id="employee-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modal-employee-name">Employee Details</h2>
            
            <div class="tabs">
                <div class="tab active" onclick="showTab('overview')">Overview</div>
                <div class="tab" onclick="showTab('performance')">Performance</div>
                <div class="tab" onclick="showTab('notes')">1:1 Notes</div>
                <div class="tab" onclick="showTab('development')">Development</div>
                <div class="tab" onclick="showTab('insights')">Insights</div>
            </div>

            <!-- Overview Tab -->
            <div id="overview-tab" class="tab-content active">
                <div class="form-group">
                    <label>Employee Name:</label>
                    <input type="text" id="modal-name">
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <input type="text" id="modal-role">
                </div>
                <div class="form-group">
                    <label>Current Baseline:</label>
                    <textarea id="modal-baseline"></textarea>
                </div>
                <button class="btn" onclick="saveEmployeeChanges()">Save Changes</button>
                <button class="btn btn-danger" onclick="deleteEmployee()">Delete Employee</button>
            </div>

            <!-- Performance Tab -->
            <div id="performance-tab" class="tab-content">
                <h3>Performance Dimensions</h3>
                
                <!-- Quarterly Progress Section -->
                <div class="quarterly-progress">
                    <div class="progress-header">Quarterly Performance Tracking</div>
                    <div class="quarterly-comparison" id="quarterly-comparison">
                        <!-- Quarterly comparison will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Focus Recommendations -->
                <div class="focus-recommendations" id="focus-recommendations">
                    <div class="progress-header">Q3 Focus Recommendations</div>
                    <div id="recommendations-list">
                        <!-- Recommendations will be populated by JavaScript -->
                    </div>
                </div>

                <h4 style="margin-top: 20px;">Current Quarter Ratings</h4>
                <div class="performance-dimensions">
                    <div class="dimension-card">
                        <div class="dimension-title">Domain Expertise</div>
                        <div class="dimension-description">
                            Do you know the Snowflake platform and how your customers use it well enough to handle most conversations with account teams and customers on their common use cases and technical issues?
                        </div>
                        <div class="rating-buttons">
                            <button class="rating-btn" data-dimension="domain" data-rating="Below">Below</button>
                            <button class="rating-btn" data-dimension="domain" data-rating="Growth">Growth</button>
                            <button class="rating-btn" data-dimension="domain" data-rating="Meets">Meets</button>
                            <button class="rating-btn" data-dimension="domain" data-rating="Exceeds">Exceeds</button>
                        </div>
                    </div>

                    <div class="dimension-card">
                        <div class="dimension-title">Business Acumen</div>
                        <div class="dimension-description">
                            Can you articulate the customer's use cases and business objectives and represent them in a meaningful way? Do you understand why they use Snowflake?
                        </div>
                        <div class="rating-buttons">
                            <button class="rating-btn" data-dimension="business" data-rating="Below">Below</button>
                            <button class="rating-btn" data-dimension="business" data-rating="Growth">Growth</button>
                            <button class="rating-btn" data-dimension="business" data-rating="Meets">Meets</button>
                            <button class="rating-btn" data-dimension="business" data-rating="Exceeds">Exceeds</button>
                        </div>
                    </div>

                    <div class="dimension-card">
                        <div class="dimension-title">Customer Partnership</div>
                        <div class="dimension-description">
                            Do you demonstrate value with the customer that instills confidence? Can you develop new relationships within their organization?
                        </div>
                        <div class="rating-buttons">
                            <button class="rating-btn" data-dimension="customer" data-rating="Below">Below</button>
                            <button class="rating-btn" data-dimension="customer" data-rating="Growth">Growth</button>
                            <button class="rating-btn" data-dimension="customer" data-rating="Meets">Meets</button>
                            <button class="rating-btn" data-dimension="customer" data-rating="Exceeds">Exceeds</button>
                        </div>
                    </div>

                    <div class="dimension-card">
                        <div class="dimension-title">Community Contributions</div>
                        <div class="dimension-description">
                            Do you lean in and bring learning opportunities or process improvements to the broader team? How do you impact our global team?
                        </div>
                        <div class="rating-buttons">
                            <button class="rating-btn" data-dimension="community" data-rating="Below">Below</button>
                            <button class="rating-btn" data-dimension="community" data-rating="Growth">Growth</button>
                            <button class="rating-btn" data-dimension="community" data-rating="Meets">Meets</button>
                            <button class="rating-btn" data-dimension="community" data-rating="Exceeds">Exceeds</button>
                        </div>
                    </div>

                    <div class="dimension-card">
                        <div class="dimension-title">Partner with Sales</div>
                        <div class="dimension-description">
                            Can you build strong relationships with account teams? Do they see you as a valuable partner and advocate for opening doors within accounts?
                        </div>
                        <div class="rating-buttons">
                            <button class="rating-btn" data-dimension="sales" data-rating="Below">Below</button>
                            <button class="rating-btn" data-dimension="sales" data-rating="Growth">Growth</button>
                            <button class="rating-btn" data-dimension="sales" data-rating="Meets">Meets</button>
                            <button class="rating-btn" data-dimension="sales" data-rating="Exceeds">Exceeds</button>
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="savePerformanceRatings()">Save Performance Ratings</button>
            </div>

            <!-- Notes Tab -->
            <div id="notes-tab" class="tab-content">
                <h3>1:1 Meeting Notes</h3>
                <div class="form-group">
                    <label>New Note:</label>
                    <textarea id="new-note" placeholder="Enter your 1:1 meeting notes here..."></textarea>
                </div>
                <button class="btn" onclick="addNote()">Add Note</button>
                
                <div class="notes-section">
                    <h4>Recent Notes</h4>
                    <div id="notes-list">
                        <!-- Notes will be dynamically loaded -->
                    </div>
                </div>
            </div>

            <!-- Development Tab -->
            <div id="development-tab" class="tab-content">
                <h3>Development Tracking</h3>
                <div class="development-grid">
                    <div class="development-card">
                        <h4>Development Areas</h4>
                        <div class="form-group">
                            <textarea id="development-areas" placeholder="What areas are you focusing on with this individual?"></textarea>
                        </div>
                    </div>

                    <div class="development-card">
                        <h4>Employee Development (Past 3 Months)</h4>
                        <div class="form-group">
                            <textarea id="past-development" placeholder="What have you done to help this person's development areas?"></textarea>
                        </div>
                    </div>

                    <div class="development-card">
                        <h4>Personal Goals/Career Planning</h4>
                        <div class="form-group">
                            <textarea id="career-goals" placeholder="What are the personal goals and aspirations being tracked?"></textarea>
                        </div>
                    </div>

                    <div class="development-card">
                        <h4>Feedback Providers</h4>
                        <div class="form-group">
                            <textarea id="feedback-themes" placeholder="What is the theme of feedback received in the last 3 months?"></textarea>
                        </div>
                    </div>

                    <div class="development-card">
                        <h4>Next 6 Months Development Plan</h4>
                        <div class="form-group">
                            <textarea id="future-development" placeholder="What are you doing to develop this person in the next 6 months?"></textarea>
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="saveDevelopmentData()">Save Development Information</button>
            </div>

            <!-- Insights Tab -->
            <div id="insights-tab" class="tab-content">
                <h3>AI-Powered Insights</h3>
                <div class="insights-panel">
                    <div id="insights-content">
                        <!-- Insights will be dynamically generated -->
                    </div>
                    <button class="btn" onclick="generateInsights()">Generate New Insights</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state management
        let employees = JSON.parse(localStorage.getItem('employees') || '[]');
        let currentEmployeeId = null;
        let currentQuarter = getCurrentQuarter();
        let selectedQuarter = currentQuarter;

        // Fiscal year functions (February start)
        function getCurrentQuarter() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1; // JavaScript months are 0-indexed
            
            if (month >= 2 && month <= 4) {
                return `Q1-${year}`; // Feb-Apr
            } else if (month >= 5 && month <= 7) {
                return `Q2-${year}`; // May-Jul
            } else if (month >= 8 && month <= 10) {
                return `Q3-${year}`; // Aug-Oct
            } else {
                // Nov-Jan (Q4 spans two calendar years)
                return month >= 11 ? `Q4-${year}` : `Q4-${year - 1}`;
            }
        }

        function getQuarterLabel(quarterKey) {
            const [quarter, year] = quarterKey.split('-');
            const fiscalYear = parseInt(year) + 1; // Feb-Jan fiscal year
            
            const quarterMap = {
                'Q1': `Q1 FY${fiscalYear} (Feb-Apr ${year})`,
                'Q2': `Q2 FY${fiscalYear} (May-Jul ${year})`,
                'Q3': `Q3 FY${fiscalYear} (Aug-Oct ${year})`,
                'Q4': `Q4 FY${fiscalYear} (Nov ${year}-Jan ${parseInt(year) + 1})`
            };
            
            return quarterMap[quarter] || quarterKey;
        }

        function addQuarters(quarterKey, delta) {
            const [q, y] = quarterKey.split('-');
            const qNum = parseInt(q.substring(1));
            const yearNum = parseInt(y);
            const index = yearNum * 4 + (qNum - 1) + delta;
            const newYear = Math.floor(index / 4);
            const newQNum = (index % 4 + 4) % 4; // handle negatives
            const normalizedQ = (newQNum + 1);
            return `Q${normalizedQ}-${newYear}`;
        }

        function generateQuarterSequence(centerQuarterKey, pastCount = 6, futureCount = 2) {
            const sequence = [];
            for (let i = pastCount; i > 0; i--) {
                sequence.push(addQuarters(centerQuarterKey, -i));
            }
            sequence.push(centerQuarterKey);
            for (let i = 1; i <= futureCount; i++) {
                sequence.push(addQuarters(centerQuarterKey, i));
            }
            return sequence;
        }

        function getPreviousQuarter(quarterKey) {
            const [quarter, year] = quarterKey.split('-');
            const quarterNum = parseInt(quarter.substring(1));
            
            if (quarterNum === 1) {
                return `Q4-${parseInt(year) - 1}`;
            } else {
                return `Q${quarterNum - 1}-${year}`;
            }
        }

        function initializeQuarterlyData(employee) {
            if (!employee.quarterlyPerformance) {
                employee.quarterlyPerformance = {};
            }
            
            if (!employee.quarterlyPerformance[selectedQuarter]) {
                const prev = getPreviousQuarter(selectedQuarter);
                const source = employee.quarterlyPerformance[prev] || employee.performance || {};
                employee.quarterlyPerformance[selectedQuarter] = {
                    domain: source.domain || 'Meets',
                    business: source.business || 'Meets',
                    customer: source.customer || 'Meets',
                    community: source.community || 'Meets',
                    sales: source.sales || 'Meets',
                    notes: [],
                    goals: '',
                    focusAreas: [],
                    achievements: []
                };
            }
        }

        // Performance dimensions
        const performanceDimensions = {
            domain: 'Domain Expertise',
            business: 'Business Acumen',
            customer: 'Customer Partnership',
            community: 'Community Contributions',
            sales: 'Partner with Sales'
        };

        // Rating values for calculations
        const ratingValues = { 'Below': 1, 'Growth': 2, 'Meets': 3, 'Exceeds': 4 };
        const ratingLabels = { 1: 'Below', 2: 'Growth', 3: 'Meets', 4: 'Exceeds' };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            buildQuarterOptions();
            updateQuarterDisplay();
            loadEmployees();
            setupEventListeners();
        });

        function updateQuarterDisplay() {
            const currentQuarterBadge = document.getElementById('current-quarter');
            const quarterSelect = document.getElementById('quarter-select');
            
            // Update current quarter badge
            currentQuarterBadge.textContent = getQuarterLabel(currentQuarter).split(' (')[0];
            
            // Set selected quarter in dropdown
            quarterSelect.value = selectedQuarter;
        }

        function buildQuarterOptions() {
            const quarterSelect = document.getElementById('quarter-select');
            if (!quarterSelect) return;
            const quarters = generateQuarterSequence(currentQuarter, 6, 2);
            quarterSelect.innerHTML = quarters.map(q => {
                const label = getQuarterLabel(q);
                const currentMark = (q === currentQuarter) ? ' - Current' : '';
                return `<option value="${q}" ${q === selectedQuarter ? 'selected' : ''}>${label}${currentMark}</option>`;
            }).join('');
        }

        function changeQuarter() {
            selectedQuarter = document.getElementById('quarter-select').value;
            
            // Refresh employee data if modal is open
            if (currentEmployeeId) {
                const employee = employees.find(emp => emp.id === currentEmployeeId);
                if (employee) {
                    initializeQuarterlyData(employee);
                    loadPerformanceRatings(employee);
                    loadQuarterlyComparison(employee);
                    generateQuarterlyRecommendations(employee);
                }
            }
            
            // Update the recommendations section title
            const recTitle = document.querySelector('.focus-recommendations .progress-header');
            if (recTitle) {
                const quarter = selectedQuarter.split('-')[0];
                recTitle.textContent = `${quarter} Focus Recommendations`;
            }
            
            buildQuarterOptions();
            updateQuarterDisplay();
        }

        function setupEventListeners() {
            // Add employee form
            document.getElementById('add-employee-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addEmployee();
            });

            // Rating button clicks
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('rating-btn')) {
                    const dimension = e.target.dataset.dimension;
                    const rating = e.target.dataset.rating;
                    selectRating(dimension, rating);
                }
            });
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Load section-specific data
            if (sectionName === 'analytics') {
                loadAnalytics();
            }
        }

        function addEmployee() {
            const name = document.getElementById('employee-name').value;
            const role = document.getElementById('employee-role').value;
            const startDate = document.getElementById('employee-start-date').value;
            const baseline = document.getElementById('employee-baseline').value;

            const employee = {
                id: Date.now().toString(),
                name: name,
                role: role,
                startDate: startDate,
                baseline: baseline,
                performance: {
                    domain: 'Meets',
                    business: 'Meets',
                    customer: 'Meets',
                    community: 'Meets',
                    sales: 'Meets'
                },
                quarterlyPerformance: {},
                notes: [],
                development: {
                    areas: '',
                    pastDevelopment: '',
                    careerGoals: '',
                    feedbackThemes: '',
                    futureDevelopment: ''
                },
                createdAt: new Date().toISOString()
            };
            
            // Initialize current quarter data
            initializeQuarterlyData(employee);

            employees.push(employee);
            saveEmployees();
            loadEmployees();
            
            // Clear form
            document.getElementById('add-employee-form').reset();
            
            // Show success message
            alert('Employee added successfully!');
            showSection('employees');
        }

        function loadEmployees() {
            const employeeList = document.getElementById('employee-list');
            
            if (employees.length === 0) {
                employeeList.innerHTML = '<p style="text-align: center; color: #666; font-size: 1.1em;">No employees added yet. Click "Add Employee" to get started.</p>';
                return;
            }

            employeeList.innerHTML = employees.map(employee => {
                const avgRating = calculateAverageRating(employee);
                return `
                    <div class="employee-card" onclick="openEmployeeModal('${employee.id}')">
                        <div class="employee-name">${employee.name}</div>
                        <div class="employee-role">${employee.role}</div>
                        <div class="performance-overview">
                            <span class="performance-badge badge-${avgRating.toLowerCase()}">${avgRating}</span>
                            <span style="font-size: 0.9em; color: #666;">${employee.notes.length} notes</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function calculateAverageRating(employee) {
            // Use current quarter data if available, otherwise fall back to main performance
            let ratings;
            if (employee.quarterlyPerformance && employee.quarterlyPerformance[currentQuarter]) {
                ratings = Object.values(employee.quarterlyPerformance[currentQuarter])
                    .filter(rating => typeof rating === 'string' && ratingValues[rating]);
            } else {
                ratings = Object.values(employee.performance);
            }
            
            if (ratings.length === 0) return 'Meets';
            
            const total = ratings.reduce((sum, rating) => sum + ratingValues[rating], 0);
            const average = total / ratings.length;
            
            if (average >= 3.5) return 'Exceeds';
            if (average >= 2.5) return 'Meets';
            if (average >= 1.5) return 'Growth';
            return 'Below';
        }

        function openEmployeeModal(employeeId) {
            currentEmployeeId = employeeId;
            const employee = employees.find(emp => emp.id === employeeId);
            
            if (!employee) return;

            // Populate modal fields
            document.getElementById('modal-employee-name').textContent = employee.name;
            document.getElementById('modal-name').value = employee.name;
            document.getElementById('modal-role').value = employee.role;
            document.getElementById('modal-baseline').value = employee.baseline;

            // Initialize quarterly data
            initializeQuarterlyData(employee);

            // Load performance ratings
            loadPerformanceRatings(employee);
            
            // Load quarterly comparison
            loadQuarterlyComparison(employee);
            
            // Generate quarterly recommendations
            generateQuarterlyRecommendations(employee);

            // Load notes
            loadNotes(employee);

            // Load development data
            loadDevelopmentData(employee);

            // Show modal
            document.getElementById('employee-modal').style.display = 'block';
            
            // Show overview tab by default
            showTab('overview');
        }

        function loadPerformanceRatings(employee) {
            // Load ratings for selected quarter
            const quarterData = employee.quarterlyPerformance[selectedQuarter];
            if (!quarterData) return;
            
            Object.keys(quarterData).forEach(dimension => {
                if (performanceDimensions[dimension]) {
                    const rating = quarterData[dimension];
                const buttons = document.querySelectorAll(`[data-dimension="${dimension}"]`);
                
                buttons.forEach(btn => {
                    btn.classList.remove('selected');
                    if (btn.dataset.rating === rating) {
                        btn.classList.add('selected');
                    }
                });
                }
            });
        }

        function loadQuarterlyComparison(employee) {
            const comparisonDiv = document.getElementById('quarterly-comparison');
            if (!comparisonDiv) return;
            
            const currentQuarterData = employee.quarterlyPerformance[selectedQuarter];
            const previousQuarter = getPreviousQuarter(selectedQuarter);
            const previousQuarterData = employee.quarterlyPerformance[previousQuarter];
            
            let html = '';
            
            // Current Quarter Card
            html += `
                <div class="quarter-card">
                    <div class="quarter-title">${getQuarterLabel(selectedQuarter)}</div>
                    ${Object.keys(performanceDimensions).map(dimension => {
                        const rating = currentQuarterData ? currentQuarterData[dimension] : 'Meets';
                        return `<div class="rating-trend">
                            <span>${performanceDimensions[dimension]}:</span>
                            <span class="performance-badge badge-${rating.toLowerCase()}">${rating}</span>
                        </div>`;
                    }).join('')}
                </div>
            `;
            
            // Previous Quarter Comparison (if exists)
            if (previousQuarterData) {
                html += `
                    <div class="quarter-card">
                        <div class="quarter-title">${getQuarterLabel(previousQuarter)} Comparison</div>
                        ${Object.keys(performanceDimensions).map(dimension => {
                            const currentRating = currentQuarterData ? ratingValues[currentQuarterData[dimension]] : 3;
                            const previousRating = ratingValues[previousQuarterData[dimension]];
                            const trend = currentRating > previousRating ? 'up' : 
                                         currentRating < previousRating ? 'down' : 'same';
                            const trendSymbol = trend === 'up' ? '↗' : trend === 'down' ? '↘' : '→';
                            
                            return `<div class="rating-trend">
                                <span>${performanceDimensions[dimension]}:</span>
                                <span class="trend-arrow trend-${trend}">${trendSymbol}</span>
                                <span class="performance-badge badge-${previousQuarterData[dimension].toLowerCase()}">${previousQuarterData[dimension]}</span>
                            </div>`;
                        }).join('')}
                    </div>
                `;
            }
            
            comparisonDiv.innerHTML = html;
        }

        function generateQuarterlyRecommendations(employee) {
            const recommendationsDiv = document.getElementById('recommendations-list');
            if (!recommendationsDiv) return;
            
            const currentQuarterData = employee.quarterlyPerformance[selectedQuarter];
            const previousQuarter = getPreviousQuarter(selectedQuarter);
            const previousQuarterData = employee.quarterlyPerformance[previousQuarter];
            
            const recommendations = [];
            
            if (!currentQuarterData) {
                recommendations.push({
                    priority: 'high',
                    title: 'Set Quarter Goals',
                    content: 'No performance data found for this quarter. Set initial ratings and goals to track progress.'
                });
            } else {
                // Analyze current performance
                const lowPerformanceAreas = Object.entries(currentQuarterData)
                    .filter(([key, rating]) => performanceDimensions[key] && (rating === 'Below' || rating === 'Growth'))
                    .map(([dimension, rating]) => ({ dimension: performanceDimensions[dimension], rating }));
                
                if (lowPerformanceAreas.length > 0) {
                    recommendations.push({
                        priority: 'high',
                        title: 'Priority Development Areas',
                        content: `Focus on improving: ${lowPerformanceAreas.map(area => area.dimension).join(', ')}. These areas need attention to meet quarterly goals.`
                    });
                }
                
                // Compare with previous quarter if available
                if (previousQuarterData) {
                    const declinedAreas = [];
                    const improvedAreas = [];
                    
                    Object.keys(performanceDimensions).forEach(dimension => {
                        const currentRating = ratingValues[currentQuarterData[dimension]];
                        const previousRating = ratingValues[previousQuarterData[dimension]];
                        
                        if (currentRating < previousRating) {
                            declinedAreas.push(performanceDimensions[dimension]);
                        } else if (currentRating > previousRating) {
                            improvedAreas.push(performanceDimensions[dimension]);
                        }
                    });
                    
                    if (declinedAreas.length > 0) {
                        recommendations.push({
                            priority: 'high',
                            title: 'Address Performance Decline',
                            content: `Performance has declined in: ${declinedAreas.join(', ')}. Investigate root causes and create action plans.`
                        });
                    }
                    
                    if (improvedAreas.length > 0) {
                        recommendations.push({
                            priority: 'low',
                            title: 'Leverage Strengths',
                            content: `Strong improvement shown in: ${improvedAreas.join(', ')}. Consider leveraging these strengths for mentoring or stretch assignments.`
                        });
                    }
                }
                
                // High performance recommendations
                const highPerformanceAreas = Object.entries(currentQuarterData)
                    .filter(([key, rating]) => performanceDimensions[key] && rating === 'Exceeds')
                    .map(([dimension, _]) => performanceDimensions[dimension]);
                
                if (highPerformanceAreas.length > 0) {
                    recommendations.push({
                        priority: 'medium',
                        title: 'Excellence Recognition',
                        content: `Excellent performance in: ${highPerformanceAreas.join(', ')}. Consider visibility opportunities and increased responsibilities.`
                    });
                }
                
                // Check for 1:1 note patterns
                if (employee.notes.length === 0) {
                    recommendations.push({
                        priority: 'medium',
                        title: 'Increase 1:1 Frequency',
                        content: 'No 1:1 notes recorded. Regular check-ins are crucial for quarterly performance tracking and support.'
                    });
                }
            }
            
            // Default recommendation if no specific issues found
            if (recommendations.length === 0) {
                recommendations.push({
                    priority: 'low',
                    title: 'Maintain Performance',
                    content: 'Performance is on track. Continue current development activities and explore new growth opportunities.'
                });
            }
            
            recommendationsDiv.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item priority-${rec.priority}">
                    <div class="insight-title">${rec.title}</div>
                    <div>${rec.content}</div>
                </div>
            `).join('');
        }

        function selectRating(dimension, rating) {
            const buttons = document.querySelectorAll(`[data-dimension="${dimension}"]`);
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            const selectedBtn = document.querySelector(`[data-dimension="${dimension}"][data-rating="${rating}"]`);
            selectedBtn.classList.add('selected');
        }

        function savePerformanceRatings() {
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee) return;

            // Initialize quarterly data if not exists
            initializeQuarterlyData(employee);
            
            // Save to quarterly performance data
            Object.keys(performanceDimensions).forEach(dimension => {
                const selectedBtn = document.querySelector(`[data-dimension="${dimension}"].selected`);
                if (selectedBtn) {
                    employee.quarterlyPerformance[selectedQuarter][dimension] = selectedBtn.dataset.rating;
                    // Also update the main performance object for current quarter
                    if (selectedQuarter === currentQuarter) {
                    employee.performance[dimension] = selectedBtn.dataset.rating;
                    }
                }
            });
            
            // Refresh quarterly comparison and recommendations
            loadQuarterlyComparison(employee);
            generateQuarterlyRecommendations(employee);

            saveEmployees();
            loadEmployees();
            alert(`Performance ratings saved for ${getQuarterLabel(selectedQuarter).split(' (')[0]}!`);
        }

        function loadNotes(employee) {
            const notesList = document.getElementById('notes-list');
            
            if (employee.notes.length === 0) {
                notesList.innerHTML = '<p style="color: #666;">No notes recorded yet.</p>';
                return;
            }

            notesList.innerHTML = employee.notes
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(note => `
                    <div class="note-item">
                        <div class="note-date">${new Date(note.date).toLocaleDateString()}</div>
                        <div class="note-content">${note.content}</div>
                    </div>
                `).join('');
        }

        function addNote() {
            const noteContent = document.getElementById('new-note').value.trim();
            if (!noteContent) return;

            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee) return;

            const note = {
                id: Date.now().toString(),
                content: noteContent,
                date: new Date().toISOString()
            };

            employee.notes.push(note);
            saveEmployees();
            loadNotes(employee);
            
            document.getElementById('new-note').value = '';
            alert('Note added successfully!');
        }

        function loadDevelopmentData(employee) {
            document.getElementById('development-areas').value = employee.development.areas || '';
            document.getElementById('past-development').value = employee.development.pastDevelopment || '';
            document.getElementById('career-goals').value = employee.development.careerGoals || '';
            document.getElementById('feedback-themes').value = employee.development.feedbackThemes || '';
            document.getElementById('future-development').value = employee.development.futureDevelopment || '';
        }

        function saveDevelopmentData() {
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee) return;

            employee.development = {
                areas: document.getElementById('development-areas').value,
                pastDevelopment: document.getElementById('past-development').value,
                careerGoals: document.getElementById('career-goals').value,
                feedbackThemes: document.getElementById('feedback-themes').value,
                futureDevelopment: document.getElementById('future-development').value
            };

            saveEmployees();
            alert('Development information saved successfully!');
        }

        function generateInsights() {
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee) return;

            const insights = [];

            // Performance analysis
            const lowPerformanceAreas = Object.entries(employee.performance)
                .filter(([_, rating]) => rating === 'Below' || rating === 'Growth')
                .map(([dimension, rating]) => ({ dimension: performanceDimensions[dimension], rating }));

            if (lowPerformanceAreas.length > 0) {
                insights.push({
                    title: 'Focus Areas Identified',
                    content: `Based on current ratings, consider focusing development efforts on: ${lowPerformanceAreas.map(area => area.dimension).join(', ')}.`
                });
            }

            // Notes analysis
            if (employee.notes.length > 0) {
                const recentNotes = employee.notes.slice(-3);
                insights.push({
                    title: 'Recent Engagement',
                    content: `${employee.notes.length} total notes recorded. Recent patterns show consistent 1:1 engagement. Consider analyzing themes from recent discussions.`
                });
            }

            // Development recommendations
            if (employee.development.areas) {
                insights.push({
                    title: 'Development Alignment',
                    content: 'Development areas have been identified. Ensure alignment between performance ratings and development focus areas for maximum impact.'
                });
            }

            // Career progression insights
            const highPerformanceAreas = Object.entries(employee.performance)
                .filter(([_, rating]) => rating === 'Exceeds')
                .map(([dimension, _]) => performanceDimensions[dimension]);

            if (highPerformanceAreas.length > 0) {
                insights.push({
                    title: 'Strengths to Leverage',
                    content: `Strong performance in: ${highPerformanceAreas.join(', ')}. Consider leveraging these strengths for mentoring opportunities or stretch assignments.`
                });
            }

            // Default insight if no specific patterns found
            if (insights.length === 0) {
                insights.push({
                    title: 'Getting Started',
                    content: 'Continue gathering data through regular 1:1s and performance observations. Insights will become more meaningful as more data is collected.'
                });
            }

            displayInsights(insights);
        }

        function displayInsights(insights) {
            const insightsContent = document.getElementById('insights-content');
            insightsContent.innerHTML = insights.map(insight => `
                <div class="insight-item">
                    <div class="insight-title">${insight.title}</div>
                    <div>${insight.content}</div>
                </div>
            `).join('');
        }

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Update tab navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Generate insights when insights tab is opened
            if (tabName === 'insights') {
                generateInsights();
            }
        }

        function saveEmployeeChanges() {
            const employee = employees.find(emp => emp.id === currentEmployeeId);
            if (!employee) return;

            employee.name = document.getElementById('modal-name').value;
            employee.role = document.getElementById('modal-role').value;
            employee.baseline = document.getElementById('modal-baseline').value;

            saveEmployees();
            loadEmployees();
            
            // Update modal title
            document.getElementById('modal-employee-name').textContent = employee.name;
            
            alert('Employee information updated successfully!');
        }

        function deleteEmployee() {
            if (!confirm('Are you sure you want to delete this employee? This action cannot be undone.')) {
                return;
            }

            employees = employees.filter(emp => emp.id !== currentEmployeeId);
            saveEmployees();
            loadEmployees();
            closeModal();
            alert('Employee deleted successfully!');
        }

        function closeModal() {
            document.getElementById('employee-modal').style.display = 'none';
            currentEmployeeId = null;
        }

        function saveEmployees() {
            localStorage.setItem('employees', JSON.stringify(employees));
        }

        function loadAnalytics() {
            const analyticsContent = document.getElementById('analytics-content');
            
            if (employees.length === 0) {
                analyticsContent.innerHTML = '<p>No data available. Add employees to see analytics.</p>';
                return;
            }

            // Current quarter performance stats
            const performanceStats = {};
            Object.keys(performanceDimensions).forEach(dimension => {
                performanceStats[dimension] = {
                    Below: 0,
                    Growth: 0,
                    Meets: 0,
                    Exceeds: 0
                };
            });

            // Quarterly trend analysis
            const quarterlyTrends = {};
            const availableQuarters = new Set();

            employees.forEach(employee => {
                // Current quarter stats
                Object.keys(employee.performance).forEach(dimension => {
                    const rating = employee.performance[dimension];
                    if (performanceStats[dimension]) {
                    performanceStats[dimension][rating]++;
                    }
                });
                
                // Collect quarterly data
                if (employee.quarterlyPerformance) {
                    Object.keys(employee.quarterlyPerformance).forEach(quarter => {
                        availableQuarters.add(quarter);
                        if (!quarterlyTrends[quarter]) {
                            quarterlyTrends[quarter] = {};
                            Object.keys(performanceDimensions).forEach(dim => {
                                quarterlyTrends[quarter][dim] = { Below: 0, Growth: 0, Meets: 0, Exceeds: 0 };
                            });
                        }
                        
                        Object.keys(performanceDimensions).forEach(dimension => {
                            const rating = employee.quarterlyPerformance[quarter][dimension];
                            if (rating && quarterlyTrends[quarter][dimension]) {
                                quarterlyTrends[quarter][dimension][rating]++;
                            }
                        });
                    });
                }
            });

            let analyticsHTML = `
                <div class="quarter-selector" style="margin-bottom: 30px;">
                    <h3>Current Quarter Performance - ${getQuarterLabel(currentQuarter).split(' (')[0]}</h3>
                </div>
                <div class="performance-dimensions">
            `;
            
            Object.entries(performanceStats).forEach(([dimension, stats]) => {
                analyticsHTML += `
                    <div class="dimension-card">
                        <h3>${performanceDimensions[dimension]}</h3>
                        <div style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Below:</span> <span>${stats.Below}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Growth:</span> <span>${stats.Growth}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Meets:</span> <span>${stats.Meets}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Exceeds:</span> <span>${stats.Exceeds}</span>
                            </div>
                        </div>
                    </div>
                `;
            });

            analyticsHTML += '</div>';

            // Quarterly trends section
            if (availableQuarters.size > 1) {
                analyticsHTML += `
                    <div class="insights-panel">
                        <h3>Quarterly Trends</h3>
                        <div class="quarterly-comparison">
                `;
                
                const sortedQuarters = Array.from(availableQuarters).sort();
                sortedQuarters.forEach(quarter => {
                    const totalEmployees = Object.values(quarterlyTrends[quarter])
                        .reduce((sum, dimension) => {
                            return sum + Object.values(dimension).reduce((dimSum, count) => dimSum + count, 0);
                        }, 0) / Object.keys(performanceDimensions).length;
                    
                    if (totalEmployees > 0) {
                        analyticsHTML += `
                            <div class="quarter-card">
                                <div class="quarter-title">${getQuarterLabel(quarter)}</div>
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                                    ${Math.round(totalEmployees)} employees tracked
                                </div>
                                ${Object.entries(quarterlyTrends[quarter]).map(([dimension, stats]) => {
                                    const total = Object.values(stats).reduce((sum, count) => sum + count, 0);
                                    if (total === 0) return '';
                                    
                                    const avgRating = Object.entries(stats)
                                        .reduce((sum, [rating, count]) => sum + (ratingValues[rating] * count), 0) / total;
                                    
                                    return `<div style="display: flex; justify-content: space-between; margin-bottom: 3px; font-size: 0.8em;">
                                        <span>${performanceDimensions[dimension]}:</span>
                                        <span class="performance-badge badge-${ratingLabels[Math.round(avgRating)].toLowerCase()}">
                                            ${ratingLabels[Math.round(avgRating)]}
                                        </span>
                                    </div>`;
                                }).join('')}
                            </div>
                        `;
                    }
                });
                
                analyticsHTML += '</div></div>';
            }

            // Team summary
            const totalNotes = employees.reduce((sum, emp) => sum + emp.notes.length, 0);
            const avgNotesPerEmployee = (totalNotes / employees.length).toFixed(1);
            
            analyticsHTML += `
                <div class="insights-panel">
                    <h3>Team Summary</h3>
                    <div class="insight-item">
                        <div class="insight-title">Team Size</div>
                        <div>${employees.length} employees</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Total 1:1 Notes</div>
                        <div>${totalNotes} notes (${avgNotesPerEmployee} avg per employee)</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Quarters Tracked</div>
                        <div>${availableQuarters.size} quarters with performance data</div>
                    </div>
                </div>
            `;

            analyticsContent.innerHTML = analyticsHTML;
        }

        function exportData(format) {
            if (employees.length === 0) {
                alert('No data to export!');
                return;
            }

            if (format === 'json') {
                const dataStr = JSON.stringify(employees, null, 2);
                downloadFile(dataStr, 'employee_data.json', 'application/json');
            } else if (format === 'csv') {
                const csvData = convertToCSV(employees);
                downloadFile(csvData, 'employee_data.csv', 'text/csv');
            }
        }

        function convertToCSV(data) {
            const headers = [
                'Name', 'Role', 'Start Date', 'Baseline',
                'Domain Expertise', 'Business Acumen', 'Customer Partnership', 
                'Community Contributions', 'Partner with Sales',
                'Development Areas', 'Past Development', 'Career Goals', 
                'Feedback Themes', 'Future Development', 'Total Notes'
            ];

            const rows = data.map(emp => [
                emp.name,
                emp.role,
                emp.startDate,
                emp.baseline,
                emp.performance.domain,
                emp.performance.business,
                emp.performance.customer,
                emp.performance.community,
                emp.performance.sales,
                emp.development.areas,
                emp.development.pastDevelopment,
                emp.development.careerGoals,
                emp.development.feedbackThemes,
                emp.development.futureDevelopment,
                emp.notes.length
            ]);

            return [headers, ...rows].map(row => 
                row.map(field => `"${String(field).replace(/"/g, '""')}"`).join(',')
            ).join('\n');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('import-file').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData)) {
                        if (confirm('This will replace all existing data. Continue?')) {
                            employees = importedData;
                            saveEmployees();
                            loadEmployees();
                            alert('Data imported successfully!');
                        }
                    } else {
                        alert('Invalid file format!');
                    }
                } catch (error) {
                    alert('Error reading file!');
                }
            };
            reader.readAsText(file);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('employee-modal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
